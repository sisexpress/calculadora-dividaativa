<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calculadora de D√≠vida - Prot√≥tipo</title>
  <style>
    /* Toggle Switch */
    .switch{position:relative;display:inline-block;width:46px;height:24px}
    .switch input{opacity:0;width:0;height:0}
    .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#4b5563;border-radius:24px;transition:.3s}
    .slider:before{position:absolute;content:"";height:18px;width:18px;left:3px;bottom:3px;background:white;border-radius:50%;transition:.3s}
    input:checked + .slider{background:var(--accent)}
    input:checked + .slider:before{transform:translateX(22px)}

    :root{--bg:#0f1724;--card:#0b1220;--accent:#06b6d4;--muted:#94a3b8;--glass:rgba(255,255,255,0.04)}
    *{box-sizing:border-box;font-family:Inter,Segoe UI,Roboto,Arial,sans-serif}
    body{margin:0;min-height:100vh;background:linear-gradient(180deg,#071025 0%, #081827 60%);color:#e6eef6}
    .container{max-width:1100px;margin:32px auto;padding:24px}
    header{display:flex;align-items:center;gap:16px}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#3b82f6);display:flex;align-items:center;justify-content:center;font-weight:700;color:#042031}
    h1{margin:0;font-size:20px}
    p.lead{color:var(--muted);margin:6px 0 18px}

    .grid{display:grid;grid-template-columns: 1fr 420px;gap:20px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}

    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:18px;border-radius:12px;box-shadow:0 6px 20px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=text], input[type=number], select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit}
    input[type=month]{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit}
    .row{display:flex;gap:12px}
    .row .col{flex:1}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;border:0;background:var(--accent);color:#022023;font-weight:600;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .small{font-size:13px;color:var(--muted)}

    .result-summary{display:flex;flex-direction:column;gap:12px}
    .proposal{padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.02)}
    .proposal-header{display:flex;justify-content:space-between;align-items:center}
    .proposal-body{display:flex;gap:12px;align-items:center}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px dashed rgba(255,255,255,0.03);text-align:left;font-size:13px}

    .config{margin-top:14px;padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);border:1px dashed rgba(255,255,255,0.03)}
    .footer-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}

    .muted-pill{padding:6px 8px;border-radius:999px;background:var(--glass);font-size:13px;color:var(--muted)}

    /* small green company card styling for visibility */
    .company-card{display:none;margin-bottom:20px;padding:12px;border-radius:10px;background:#e8f9ef;border:1px solid #b6e6c4;color:#1b5e20}
    .company-card h4{margin:0 0 8px 0}

    /* print stylesheet for PDF export area */
    @media print{
      body{background:white;color:black}
      .no-print{display:none}
      .container{max-width:100%;padding:10px}
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- CARD DE EMPRESA ENCONTRADA -->
    <div id="cardEmpresa" class="company-card" aria-live="polite">
      <div style="display:flex;align-items:center;gap:8px;font-weight:600;font-size:15px;margin-bottom:8px">
        <span style="font-size:18px">‚úî</span>
        <span>Empresa encontrada</span>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:13px;color:#1b5e20">
        <div>
          <strong>Raz√£o Social</strong><br>
          <span id="cardRazao">-</span>
        </div>
        <div>
          <strong>Nome Fantasia</strong><br>
          <span id="cardFantasia">-</span>
        </div>
        <div>
          <strong>Respons√°vel</strong><br>
          <span id="cardResponsavel">-</span>
        </div>
        <div>
          <strong>Endere√ßo</strong><br>
          <span id="cardEndereco">-</span>
        </div>
      </div>
    </div>
    <!-- FIM DO CARD -->

    <header>
      <div class="logo">CD</div>
      <div>
        <h1>Calculadora de D√≠vida - Prot√≥tipo</h1>
        <p class="lead">Autoatendimento: consulte CNPJ, informe valores e gere propostas com descontos e simula√ß√µes de parcelas.</p>
      </div>
    </header>

    <div class="grid">
      <div>
        <div class="card">
          <h3>Dados do Cliente</h3>
          <div style="margin-top:12px">
            <label for="cnpj">CNPJ</label>
            <div style="display:flex;gap:8px"><input id="cnpj" type="text" placeholder="Digite o CNPJ (somente n√∫meros)" /><button id="btnBuscar" class="btn">Buscar</button></div>
            <p class="small">Busca via BrasilAPI. Caso n√£o encontre, preencha manualmente.</p>
          </div>

          <button id="btnEditarDados" class="btn ghost" style="margin-top:12px">Editar dados manualmente</button>
<div id="dadosManuais" style="display:none">
  <div style="margin-top:12px">
    <label>Raz√£o Social</label>
    <input id="razao" type="text" />
  </div>

  <div style="margin-top:12px">
    <label>Nome Fantasia / Respons√°vel</label>
    <input id="fantasia" type="text" />
  </div>

  <div style="margin-top:12px">
    <label>Endere√ßo</label>
    <input id="endereco" type="text" />
  </div>
</div>

          <hr style="margin:16px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)" />

          <h3>Dados da D√≠vida</h3>
          <div style="margin-top:8px">
            <label>Qual valor da d√≠vida? (R$)</label>
            <input id="valorDivida" type="text" placeholder="R$ 0,00" />
          </div>

          <div style="margin-top:8px">
            <label>N√∫mero da CDA (alfanum√©rico)</label>
            <input id="cda" type="text" />
          </div>

          <div style="margin-top:8px" class="row">
            <div class="col">
              <label>Contrata seguro garantia?</label>
              <label class="switch"><input id="seguro" type="checkbox"><span class="slider"></span></label>
            </div>
            <div class="col">
              <label>Tem faturamento?</label>
              <label class="switch"><input id="faturamentoTem" type="checkbox"><span class="slider"></span></label>
            </div>
          </div>

          <div style="margin-top:8px">
            <label>Se sim, qual o seu faturamento (R$)?</label>
            <input id="faturamentoValor" type="text" placeholder="R$ 0,00" disabled />
          </div>

          <div class="footer-actions no-print">
            <button id="btnCalcular" class="btn">Calcular propostas</button>
            <button id="btnLimpar" class="btn ghost">Limpar</button>
          </div>

          <div class="config">
          <h3 style="margin-top:12px">Taxa SELIC do M√™s</h3>
          <div class="card" style="margin-top:10px;padding:12px;background:#0d1a2b;border:1px solid rgba(255,255,255,0.05)">
            <label>M√™s de refer√™ncia</label>
            <input id="selicMes" type="month" />
            <div style="margin-top:10px;font-size:14px;color:#cbd5e1">
              <div>üìä SELIC Oficial do m√™s: <strong id="selicMesValor">--</strong></div>
              <div style="margin-top:6px">Usar taxa:</div>
              <label class="switch"><input id="selicModoOficial" type="checkbox" checked><span class="slider"></span></label> <span>Oficial do m√™s</span>
            </div>
          </div>
            <strong class="small">Configura√ß√µes (provis√≥rio)</strong>
            <div style="margin-top:8px">
              <label>Desconto m√°ximo por Seguro (%)</label>
              <input id="descontoSeguroMax" type="number" min="0" max="100" value="40" />
            </div>
            <div style="margin-top:8px">
              <label>Taxa de juros mensal padr√£o (%)</label>
              <input id="jurosMensal" type="number" step="0.01" min="0" value="1.5" />
              <p class="small">Selic da base do Banco Central.</p>
            </div>  
            <div style="margin-top:8px">
              <label>Op√ß√µes de parcelas (separe por v√≠rgula)</label>
              <input id="opcoesParcelas" type="text" value="1,3,6,12,24" />
            </div>
          </div>

        </div>

        <div class="card" style="margin-top:16px">
          <h3>Exportar / Imprimir</h3>
          <p class="small">Voc√™ pode exportar a √°rea de resultados para PDF usando impress√£o do navegador ou gerar um relat√≥rio simples.</p>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="btnPrint" class="btn">Imprimir / Salvar PDF</button>
            <button id="btnExportJSON" class="btn ghost">Exportar JSON</button>
          </div>
        </div>

      </div>

      <aside>
        <div class="card">
          <h3>Propostas & Simula√ß√µes</h3>
          <div id="areaResultados" style="margin-top:12px">
            <p class="small">Nenhuma simula√ß√£o ainda. Preencha os dados e clique em <strong>Calcular propostas</strong>.</p>
          </div>

          <div class="no-print" style="margin-top:12px">
            <label>Escolha uma proposta para ver tabela de parcelas</label>
            <select id="selecionaProposta">
              <option value="">-- nenhuma --</option>
            </select>
          </div>

          <div id="tabelaParcelas" style="margin-top:12px"></div>
        </div>
      </aside>
    </div>

    <footer style="margin-top:18px;color:var(--muted);font-size:13px">Prot√≥tipo ‚Äî calculadora de d√≠vida. Integra√ß√£o com BrasilAPI (CNPJ) configurada. Desenvolvido para autoatendimento.</footer>
  </div>

  <script>
    // --- Helpers ---
    const $ = id => document.getElementById(id);

    function onlyDigits(s){return (s||'').toString().replace(/\D/g,'')}
    function money(v){return Number(v||0).toLocaleString('pt-BR',{style:'currency',currency:'BRL'})}

    // parse currency strings like "R$ 1.234,56" or "1234,56" into number (float)
    function parseCurrencyString(s){
      if(!s) return 0;
      const digits = (s||'').toString().replace(/\D/g,'');
      if(digits==='') return 0;
      return parseInt(digits,10)/100;
    }

    // auto format currency for inputs
    function attachCurrencyMask(id){
      const el = $(id);
      if(!el) return;
      el.addEventListener('input',()=>{
        const caret = el.selectionStart;
        let raw = el.value.replace(/\D/g,'');
        if(raw==='') { el.value=''; return; }
        const num = (parseInt(raw,10)/100).toFixed(2);
        el.value = Number(num).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
        // try to restore caret near end
        el.setSelectionRange(el.value.length, el.value.length);
      });
      el.addEventListener('focus',()=>{
        // remove formatting so user can type digits
        const n = el.value.replace(/\D/g,'');
        el.value = n;
      });
      el.addEventListener('blur',()=>{
        const raw = el.value.replace(/\D/g,'');
        if(raw==='') { el.value=''; return; }
        const num = (parseInt(raw,10)/100).toFixed(2);
        el.value = Number(num).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
      });
    }

    // PRICE (sistema franc√™s) - parcela fixa
    function calcPrice(valor, jurosMensal, n){
      const i = jurosMensal/100;
      if(i === 0) return {parcela: valor/n, total: valor, jurosTotal:0};
      const parcela = valor * (i / (1 - Math.pow(1+i, -n)));
      const total = parcela * n;
      const jurosTotal = total - valor;
      return {parcela, total, jurosTotal};
    }

    // bot√£o para mostrar/ocultar dados manuais
$('btnEditarDados').addEventListener('click',()=>{
  const box = $('dadosManuais');
  box.style.display = box.style.display==='none' ? 'block' : 'none';
});

// --- UI bindings ---
    // faturamento checkbox toggles input
    $('faturamentoTem').addEventListener('change',(e)=>{
      const checked = e.target.checked;
      $('faturamentoValor').disabled = !checked;
      if(!checked) $('faturamentoValor').value = '';
    });

    // Buscar CNPJ via BrasilAPI
    $('btnBuscar').addEventListener('click', async ()=>{
      const raw = onlyDigits($('cnpj').value);
      if(raw.length < 14){alert('Informe um CNPJ com 14 d√≠gitos'); return}
      const cnpj = raw;
      $('btnBuscar').disabled = true; $('btnBuscar').textContent = 'Buscando...';
      try{
        const res = await fetch('https://brasilapi.com.br/api/cnpj/v1/'+cnpj);
        if(!res.ok) throw new Error('N√£o encontrado');
        const data = await res.json();
        // Map fields (corrigido para MEI e card)
        // Raz√£o Social
        $('razao').value = data.razao_social || data.nome || '';

        // Nome Fantasia (sem fallback estranho e sem '(MEI)')
        $('fantasia').value = data.nome_fantasia || data.razao_social || '';

        // Endere√ßo
        let endereco = [
          data.logradouro,
          data.numero,
          data.complemento,
          data.bairro,
          `${data.municipio} - ${data.uf}`,
          `CEP: ${data.cep}`
        ].filter(Boolean).join(', ');
        $('endereco').value = endereco;

        // Preencher CARD
        $('cardRazao').textContent = $('razao').value || '-';
        $('cardFantasia').textContent = $('fantasia').value || '-';
        $('cardResponsavel').textContent = data.razao_social || '-';
        $('cardEndereco').textContent = endereco || '-';
        $('cardEmpresa').style.display = 'block';
      }catch(err){
        console.error(err);
        alert('Erro ao buscar CNPJ: '+err.message+'. Voc√™ pode preencher manualmente.');
      }finally{
        $('btnBuscar').disabled = false; $('btnBuscar').textContent = 'Buscar';
      }
    });

    // Limpar
    $('btnLimpar').addEventListener('click', ()=>{
      ['cnpj','razao','fantasia','endereco','valorDivida','cda','faturamentoValor'].forEach(id=>$(id).value='');
      $('seguro').checked = false; $('faturamentoTem').checked = false; $('faturamentoValor').disabled = true;
      $('areaResultados').innerHTML = '<p class="small">Nenhuma simula√ß√£o ainda. Preencha os dados e clique em <strong>Calcular propostas</strong>.</p>';
      $('selecionaProposta').innerHTML = '<option value="">-- nenhuma --</option>';
      $('tabelaParcelas').innerHTML='';
    });

    // Calcular propostas
    $('btnCalcular').addEventListener('click', ()=>{
      const valor = parseCurrencyString($('valorDivida').value);
      if(!valor || valor <= 0){alert('Informe o valor da d√≠vida'); return}
      const seguro = $('seguro').checked;
      const descontoSeguroMax = Number($('descontoSeguroMax').value) || 0;
      const jurosMensal = Number($('jurosMensal').value) || 1.5;
      const opcoes = ($('opcoesParcelas').value || '1,6,12').split(',').map(s=>parseInt(s.trim())).filter(n=>Number.isInteger(n) && n>0);

      // Build proposals list
      const proposals = [];

      // Proposal: √† vista (1 parcela) with maximum discount if insurance
      const baseDesconto = seguro ? descontoSeguroMax : 0; // %
      proposals.push({
        id: 'avista',
        title: '√Ä vista (liquida√ß√£o √∫nica)',
        parcelas: 1,
        descontoPercent: baseDesconto,
        jurosMensal: 0
      });

      // Other parcel options
      const maxN = Math.max(...opcoes);
      opcoes.forEach(n=>{
        if(n === 1) return; // j√° temos √† vista
        const descontoAplicado = Math.round(baseDesconto * Math.max(0, 1 - (n-1)/(maxN))) ;
        proposals.push({id:`p_${n}`, title:`${n}x`, parcelas:n, descontoPercent:descontoAplicado, jurosMensal:jurosMensal});
      });

      renderProposals(valor, proposals);

    });

    function renderProposals(valorOriginal, proposals){
      const area = $('areaResultados');
      area.innerHTML='';
      const sel = $('selecionaProposta'); sel.innerHTML='<option value="">-- nenhuma --</option>';

      proposals.forEach((p, idx)=>{
        const div = document.createElement('div'); div.className='proposal';
        const header = document.createElement('div'); header.className='proposal-header';
        const left = document.createElement('div'); left.innerHTML=`<strong>${p.title}</strong><div class="small">${p.parcelas} parcela(s)</div>`;
        const right = document.createElement('div'); right.innerHTML=`<div style="text-align:right"><div class="muted-pill">Desconto ${p.descontoPercent}%</div><div style="font-weight:700;margin-top:6px">`+money(valorOriginal * (1 - p.descontoPercent/100))+`</div></div>`;
        header.appendChild(left); header.appendChild(right);
        div.appendChild(header);

        const body = document.createElement('div'); body.className='proposal-body';
        const btnView = document.createElement('button'); btnView.className='btn ghost'; btnView.textContent='Ver detalhes';
        btnView.addEventListener('click', ()=>{
          sel.value = p.id; sel.dispatchEvent(new Event('change'));
        });
        body.appendChild(btnView);

        const summary = document.createElement('div'); summary.style.marginLeft='8px';
        const valorLiquido = valorOriginal * (1 - p.descontoPercent/100);
        const calc = calcPrice(valorLiquido, p.jurosMensal || 0, p.parcelas);
        summary.innerHTML = `<div class=\"small\">Parcela estimada: <strong>${money(calc.parcela)}</strong></div><div class=\"small\">Total pago: <strong>${money(calc.total)}</strong> (Juros ${money(calc.jurosTotal)})</div>`;
        body.appendChild(summary);

        div.appendChild(body);
        area.appendChild(div);

        const opt = document.createElement('option'); opt.value = p.id; opt.textContent = `${p.title} ‚Äî ${p.parcelas}x ‚Äî ${p.descontoPercent}% desconto`; sel.appendChild(opt);
      });

      window._proposals_cache = {valorOriginal, proposals};

    }

    // Show table when selecting a proposal
    $('selecionaProposta').addEventListener('change', (e)=>{
      const id = e.target.value; const cache = window._proposals_cache;
      const area = $('tabelaParcelas'); area.innerHTML='';
      if(!id || !cache) return;
      const p = cache.proposals.find(x=>x.id===id);
      if(!p) return;
      const valorLiquido = cache.valorOriginal * (1 - p.descontoPercent/100);
      const {parcela, total, jurosTotal} = calcPrice(valorLiquido, p.jurosMensal || 0, p.parcelas);

      const info = document.createElement('div'); info.className='card'; info.style.marginTop='8px';
      info.innerHTML = `<strong>Simula√ß√£o: ${p.title}</strong><div class="small">Valor l√≠quido: ${money(valorLiquido)} ‚Ä¢ Parcela fixa estimada: ${money(parcela)} ‚Ä¢ Total: ${money(total)} ‚Ä¢ Juros: ${money(jurosTotal)}</div>`;

      const table = document.createElement('table');
      const thead = document.createElement('thead'); thead.innerHTML = '<tr><th>#</th><th>Parcela</th><th>Saldo Devedor</th><th>Amortiza√ß√£o</th><th>Juros</th></tr>';
      table.appendChild(thead);
      const tbody = document.createElement('tbody');

      let saldo = valorLiquido;
      for(let k=1;k<=p.parcelas;k++){
        const juros = saldo * ( (p.jurosMensal||0)/100 );
        const amort = parcela - juros;
        const saldoNovo = Math.max(0, saldo - amort);
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${k}</td><td>${money(parcela)}</td><td>${money(saldo)}</td><td>${money(amort)}</td><td>${money(juros)}</td>`;
        tbody.appendChild(tr);
        saldo = saldoNovo;
      }
      table.appendChild(tbody);

      area.appendChild(info); area.appendChild(table);

      const printArea = document.createElement('div'); printArea.id='printableReport'; printArea.style.display='none';
      printArea.innerHTML = `<h2>Relat√≥rio de Proposta</h2><p>${document.querySelector('h1').textContent}</p>`;
      area.appendChild(printArea);

    });

    // Print / Save PDF
    $('btnPrint').addEventListener('click', ()=>{
      window.print();
    });

    // Export JSON
    $('btnExportJSON').addEventListener('click', ()=>{
      const cache = window._proposals_cache || {};
      const payload = {
        timestamp: new Date().toISOString(),
        empresa: {
          cnpj: $('cnpj').value,
          razao: $('razao').value,
          fantasia: $('fantasia').value,
          endereco: $('endereco').value
        },
        divida: {
          valor: parseCurrencyString($('valorDivida').value),
          cda: $('cda').value,
          seguro: !!$('seguro').checked,
          faturamentoTem: !!$('faturamentoTem').checked,
          faturamentoValor: parseCurrencyString($('faturamentoValor').value)
        },
        calculoConfig: {
          descontoSeguroMax: Number($('descontoSeguroMax').value)||0,
          jurosMensal: Number($('jurosMensal').value)||1.5,
          opcoesParcelas: ($('opcoesParcelas').value||'').split(',').map(s=>s.trim())
        },
        resultados: cache
      };
      const blob = new Blob([JSON.stringify(payload,null,2)],{type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'proposta_divida.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    // Accessibility / small niceties
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter' && document.activeElement === $('cnpj')){ e.preventDefault(); $('btnBuscar').click(); }
    });

    // --- SELIC (s√©rie 1178) ---
    async function carregarSelic(mes) {
      // mes expected like 'YYYY-MM'
      try{
        // if not provided, default to current month
        let target = mes;
        if(!target){
          const now = new Date();
          const mm = String(now.getMonth()+1).padStart(2,'0');
          const yyyy = now.getFullYear();
          target = `${yyyy}-${mm}`;
          // set the input value so user sees it
          if($('selicMes')) $('selicMes').value = target;
        }
        const parts = target.split('-');
        if(parts.length !== 2) throw new Error('Formato de m√™s inv√°lido');
        const [ano, mesNum] = parts;

        const url = `https://api.bcb.gov.br/dados/serie/bcdata.sgs.11/dados?formato=json&dataInicial=01/${mesNum}/${ano}&dataFinal=31/${mesNum}/${ano}`;
        const res = await fetch(url);
        if(!res.ok) throw new Error('Falha ao buscar dados do Bacen');

        const texto = await res.text();
        let dados = [];
        try{ dados = JSON.parse(texto); }catch(e){ console.error('Resposta SELIC n√£o √© JSON:', texto); throw new Error('Formato inesperado do Bacen'); }

        if(!Array.isArray(dados) || dados.length===0){
          if($('selicMesValor')) $('selicMesValor').textContent = 'N√£o dispon√≠vel';
          console.warn('BC n√£o retornou SELIC para o per√≠odo', mesNum, ano);
          return;
        }

        const item = dados[dados.length-1];
        const valor = String(item.valor).replace(',','.');

        if($('selicMesValor')) $('selicMesValor').textContent = valor.replace('.',',') + '%';
        if($('selicModoOficial') && $('selicModoOficial').checked){
          if(!Number.isNaN(Number(valor))) $('jurosMensal').value = parseFloat(valor).toFixed(2);
        }

      }catch(e){
        console.error('Erro SELIC', e);
        if($('selicMesValor')) $('selicMesValor').textContent = 'Erro ao obter SELIC';
      }
    }

    // wire events safely only if elements exist
    if($('selicMes')){
      // initialize with current month and load
      const now = new Date();
      const mm = String(now.getMonth()+1).padStart(2,'0');
      const yyyy = now.getFullYear();
      $('selicMes').value = `${yyyy}-${mm}`;
      $('selicMes').addEventListener('change', e=>carregarSelic(e.target.value));
    }
    if($('selicModoOficial')){
      $('selicModoOficial').addEventListener('change', ()=>{
        if($('selicModoOficial').checked){
          carregarSelic($('selicMes')?.value);
        }
      });
    }

    // initial load
    carregarSelic($('selicMes')?.value).catch(()=>{});

    // Init: set faturamento disabled and attach masks
    attachCurrencyMask('valorDivida');
    attachCurrencyMask('faturamentoValor');
    $('faturamentoValor').disabled = true;

    // NOTES for future integration (comments):
    /*
      - Hoje usamos BrasilAPI para buscar CNPJ. Se for necess√°ria autentica√ß√£o ou alta disponibilidade, trocar por proxy backend.
      - A l√≥gica de descontos √© configur√°vel no painel. Voc√™ pediu: seguro permite at√© 40% ‚Äî deixamos isso como valor padr√£o.
      - Juros mensais padr√£o configur√°vel (1.5%). Futuramente podemos buscar SELIC via Supabase e recalcular.
      - Export JSON/Imprimir pronto; se quiser gerar PDF com layout customizado (multipage), podemos integrar jsPDF ou backend.
      - Para produ√ß√£o: validar CNPJ com m√°scara e adicionar tratamento de erros mais robusto.
    */

  </script>
</body>
</html>
